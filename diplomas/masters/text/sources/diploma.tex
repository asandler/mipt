\documentclass{article}
\usepackage[T2A]{fontenc} 
\usepackage[cp1251]{inputenc}
\usepackage[russian]{babel}
\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{setspace}
\usepackage{cyrtimes}
\usepackage[top=20mm, bottom=20mm, left=30mm, right=15mm]{geometry}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{multirow}

\renewcommand{\baselinestretch}{1.5}

\doublespacing

\makeatletter
\renewcommand\section{\@startsection {section}{1}{\z@}%
   {-3.5ex \@plus -1ex \@minus -.2ex}%
   {2.3ex \@plus.2ex}%
   {\normalfont\LARGE\bfseries}}% from \Large
\renewcommand\subsection{\@startsection{subsection}{2}{\z@}%
   {-3.25ex\@plus -1ex \@minus -.2ex}%
   {1.5ex \@plus .2ex}%
   {\normalfont\Large\bfseries}}% from \large
\makeatother

\begin{document}

\thispagestyle{empty}

\begin{tabular}{p{2.5cm}p{9.5cm}p{3.1cm}}
    \parbox{3.1cm}{\centering
        \includegraphics[width=3cm]{pictures/logo_mipt}
    }

    &
    \parbox{10cm}{\centering
        МОСКОВСКИЙ ФИЗИКО-ТЕХНИЧЕСКИЙ ИНСТИТУТ \\
        (ГОСУДАРСТВЕННЫЙ УНИВЕРСИТЕТ) \\
        ФАКУЛЬТЕТ ИННОВАЦИЙ И ВЫСОКИХ ТЕХНОЛОГИЙ \\
        \underline{\textit{КАФЕДРА ФИЗИКО-ТЕХНИЧЕСКОЙ ИНФОРМАТИКИ}} \\
    }

    &
    \parbox{3.1cm}{\centering
        \includegraphics[width=3cm]{pictures/logo_icpt} \\
    }
\end{tabular}

\vspace{13em}

\begin{center}
\LARGE
\textit{\textbf{Выпускная квалификационная работа Магистра}}

\textit{\textbf{(Магистерская диссертация)}}

\textbf{по теме «Исследование восприятия динамических 3D-сцен в тренажёрах с системами виртуального окружения»}
\end{center}

\par\vspace*{\fill}

\begin{flushright}
\large
\parbox{110mm}{Тема утверждена на заседании Государственной
экзаменационной комиссии Кафедры Физико-технической
информатики (протокол No 6/2015 от 8 сентября 2015 г.)}
\end{flushright}
\large
\begin{tabular}{p{2.1in} p{1.3in} c}

Магистрант & & \underline{\ \ \ \ \ \ Сандлер Андрей Дмитриевич\ \ \ \ \ \ \ } \\

& & (Ф.И.О.) \\

Научный руководитель & \underline{\parbox{1.1in}{\ }} & \underline{\ \ \ \ \ \ \ \ \ \ к.т.н., доцент Алешин В.П.\ \ \ \ \ \ \ \ } \\

& (подпись) & (ученая степень, ученое звание, Ф.И.О.) \\
\end{tabular}

\vfill

\begin{center}
Москва, 2016
\end{center}

\newpage
\Large

\thispagestyle{empty}
\tableofcontents
\thispagestyle{empty}

\newpage

\section{Введение}
\subsection{Актуальность темы диссертации}
Известно, что процесс тренировки на тренажёре с системой виртуального окружения во многом зависит от того, насколько хорошо человек погружается
в процесс тренировки. К примеру, автомобильный или самолётный тренажёр часто снабжают механическими частями кабины для того, чтобы повысить
реалистичность управления по сравнению с виртуальными панелями и рычагами управления. Но, помимо механики, немаловажную роль играет визуальная
составляющая тренажёра - система виртуального окружения.

Для улучшения эффекта тренировок необходимо научиться оценивать, насколько хорошо тренирующийся воспринимает окружающее его виртуальное
пространство. При наличии способа оценки данной величины (метрики) появляется возможность эту метрику увеличивать или уменьшать (в зависимости
от поставленной задачи), и тем самым влиять на ход тренировочного процесса в лучшую сторону. На данный момент не существует способа численно
оценить <<реалистичность>> тренажёра и степень погружения в тренировочный процесс (все предыдущие подходы к такой оценке были сугубо качественные),
однако, задача разработки способа численной оценки погружения является крайне актуальной, например, для самолётного тренажёра МиГ или
горнолыжного тренажёра в МФТИ. По словам пилотов, тренирующихся на тренажёре МиГ, процесс полёта на нём воспринимается очень нереалистично по
сравнению с настоящим истребителем МиГ-29. Автор данной работы лично поучаствовал в тренировке на тренажёре МиГ, и подтверждает (со своей
непрофессиональной точки зрения), что это мало чем напоминает полёт на настоящем самолёте.

Помимо оценивания погружения в процесс тренировки, актуальной является и задача разработки бинокулярного интерфейса для тренажёров с
использованием трекинга головы и глаз. Такой интерфейс позволяет создавать вокруг тренирующегося более реалистичное виртуальное окружение
с учётом его местонахождения в пространстве и направления взгляда. В настоящей работе автором реализован модуль совмещения реальных и
виртуальных объектов 3D-сцены, необходимый для тренажёров с комбинированной виртуальной сценой, дополненной реальными пультами управления,
например, МиГ, где в режиме дозаправки в воздухе виртуальный конус заправочного шланга совмещается с реальной механической кабиной. В
варианте реализации тренажёра без этого модуля, реальные и виртуальные объекты не совмещаются, и картинка <<разваливается>> при любом
повороте или перемещении головы пилота. Использование модуля позволяет добиться совмещения объектов при любом положении тренирующегося и
за счёт этого получить более глубокое погружение в процесс тренировки.

\subsection{Обзор связанных работ}
Вопросы 3D восприятия и человеко-машинного интерфейса исследуются уже достаточно давно. Следует отметить пионерские работы
\cite{rauschenbach1}, \cite{rauschenbach2}, \cite{rauschenbach3} академика Б.В. Раушенбаха, соратника Ю.П. Королева,
и американского ученого Д.Марра \cite{marr}.

Термин <<погружение в виртуальное окружение>>(\textit{immersive virtual reality}) рассматривается в работах Мэла Слейтера \cite{slater1997a},
\cite{slater2009a}. Оно определяется как <<технология, способная воссоздать вокруг наблюдателя всеобъемлющее, воздействующее на различные
органы восприятия окружение, создающее яркую иллюзию присутствия>>. В данных работах обозначаются принципы, по которым можно оценивать
погружение в виртуальное окружение (Inclusive (I), Extensive (E), \\ Surrounding (S), Vivid (V)), и приводятся условия, при которых возможно
погружение: малые задержки в рендеринге кадров, статистическая правдоподобность сцен и причинно-следственные связи при взаимодействии со
средой.

Большое внимание визуальному восприятию уделяется в экспериментальной медицине. В работах \cite{persky2009a}, \cite{blascovich1999a},
\cite{blascovich2002a} и \cite{rachel2003a} технологии погружения в виртуальное окружение рассматриваются как инструменты исследования в психологии, поведенческом
анализе, социальных геномных исследованиях и даже реабилитации пациентов. Однако, способов оценивания погружения в них не приводится.

Работа \cite{mine1997a} касается проблемы, которая возникает при передвижении объектов в виртуальном пространстве, а именно - плохо выражен
уровень реалистичности, и, соответственно, мало погружение в процесс. В немалой степени это связано с тем, что тактильные ощущения, в отличие
от визуальных, гораздо труднее воспроизвести искусственно.

В работе Станислава Владимировича Клименко и Максима Брагуты \cite{klimenko2008a} рассматривается возможность применения технологии виртуального
окружения для нужд диспетчерского управления сложными технологическими процессами. Даётся обзор технологий, позволяющий достичь требуемого уровня
погружения в процесс управления, обосновывается необходимость такого рода систем в связи с всё возрастающим объёмом информации, который
приходится обрабатывать диспетчерам. Погружение в данном случае измеряется временем реакции диспетчера на внештатные ситуации по сравнению с управлением
без виртуального окружения, количеством допущеных ошибок и уровнем психофизического состояния, который может быть измерен с помощью медицинских
приборов.

Существует целый ряд работ, направленных на изучение восприятия отдельных параметров виртуального окружения, таких, как скорость передвижения,
расстояние до объекта, размеры объектов, глубина изображения и длина пройденного пути. Так, в статье \cite{banton2005a} показано, что визуальное
восприятие скорости у наблюдателя в виртуальном окружении смещено в сторону занижения действительных значений (воспринимается как более медленное).
Этот эффект таит в себе потенциальную опасность при тренировке навыков, так или иначе связанных с восприятием скорости (например, обучение
вождению автомобиля). В ходе работы на горнолыжном тренажёре спортсмены также заявляли, что воспринимаемая ими на экране скорость передвижения (порядка
60 км/ч, 16 м/c) кажется гораздо меньше, чем скорость при спуске на настоящем склоне.

Восприятие расстояний в виртуальном окружении рассматривается в работах \cite{interrante2006a} и \cite{witmer1998a}. Зависимость воспринимаемого
расстояния от параметров системы виртуального окружения изучается в \cite{willemsen2008a}. Общее заключение из этих работ гласит о том, что
расстояния кажутся наблюдателю меньше, чем они есть на самом деле, однако, при тщательно настроенных параметрах системы данный эффект становится
менее выражен.

Размеры объектов, ожидаемо, тоже кажутся наблюдателям меньше, чем они есть на самом деле (см. \cite{stefanucci2012a}). В работе \cite{rolland1993a}
также показано, что реальные объекты кажутся наблюдателю ближе, чем виртуальные, расположенные на такой же глубине. Сравнивая восприятие одних и
тех же виртуальных объектов через 2D LCD-дисплей и систему виртуального окружения, авторы статьи \cite{g2012a} приходят к выводу, что восприятие
в последней значительно более реалистичное, а погружение - сильнее.

Кроме работ, оценивающих отдельные аспекты погружения в виртуальное окружение, есть ряд статей, в которых авторы пытаются рассмотреть этот вопрос
с более общих позиций. Так, например, в работе \cite{franco2015a} описывается поведение наблюдателей в виртуальном музее и взаимодействие с
экспонатами. На основе опросов участников эксперимента делается вывод о том, что уровень взаимодействия с объектами повышается при использовании
технологий виртуального окружения. Довольно общий подход к измерению присутствия и погружения в 3D-сцену даётся Робертом Витмером в
\cite{witmer1998b}. Это измерение основано на опроснике с большим числом вопросов, на которые предлагается отвечать по некоторой относительной
шкале. Мэл Слейтер позже выпустил статью \cite{slater1999a}, в которой критикует предложенную Витмером анкету, а также подвергает сомнению
некоторые из сделанных в \cite{witmer1998b} выводов (к примеру, о логической взаимосвязи между успешностью выполнения заданий, предлагаемых в
эксперименте, и чувством присутствия в сцене). Вместо этого опросника Слейтер предлагает использовать другой, который называется Immersive
Tendencies Questionnaire (ITQ).

Исследование восприятия при погружении в большую, сложную 3D-сцену проводится в работе \cite{van1998a} коллектива учёных из института им. Макса
Планка. Для исследования была воссоздана 3D-модель немецкого города Тюбинген, на примере которой изучался вопрос навигации человека в городе.
Улучшение или ухудшение параметров навигации отражает степень погружения наблюдателя в процесс ориентирования в виртуальном пространстве. Там же
подтверждаются выводы о восприятии скорости в виртуальном пространстве.

Предыдущие работы на горнолыжном тренажёре МФТИ (\cite{aleshin-a}, \cite{aleshin-b}) затрагивают вопросы оценки восприятия 3D-сцены человеком.
Тренажёр снабжён оптической системой трекинга, которая позволяет включить реакцию на перемещение наблюдателя в режиме реального времени.
В экспериментах было отмечено, что виртуальное окружение лучше воспринимается в условиях сцены со стабильным горизонтом. Поворачивание камеры
вслед за поворотом головы спортсмена приводит к дрожанию изображения, потере реалистичности и худшему восприятию.

Качество изображения 3D-сцены также влияет на погружение. В работе \cite{slater2009b} показано, что наблюдатели, которым показывали сцену,
построенную с помощью алгоритма рекурсивного рей-трейсинга (Real-Time Recursive Ray Tracing), включающего отображение теней и отражений,
воспринимали её реальнее, чем те, которым та же сцена была изображена с помощью алгоритма нерекурсивного бросания лучей (без отражений и теней).

Наконец, даже сама 3D-сцена может влиять на то, насколько сильно наблюдатель погружается в неё. В статье \cite{lange2001a} рассматривается
вопрос реалистичности восприятия ландшафтов, и делается вывод о том, что для корректного и полного восприятия необходима очень существенная
детализация сцены. Психофизиологический аспект восприятия изучается в работе \cite{garau2005a}. Показано, что люди с низкой степенью социальной
активности чаще избегают взаимодействия с виртуальными человекоподобными изображениями. Изучению взаимодействия между людьми, решений и действий
человека в виртуальной среде также посвящена работа команды Bunraku (INRIA, Франция) \cite{bunraku}.

Вышеперечисленные работы осуществлялись на различных системах виртуального окружения. На сегодняшний день существует несколько таких систем,
обеспечивающих максимальное погружение:
\begin{itemize}
    \item[--] CAVE \cite{cave}. Описанная, как система <<полного погружения>>, она состоит из проекторов, выводящих изображение на четыре стены
    и пол, звуковые динамики, расположенные под разными углами, систему трекинга и вмонтированную в стены. Оператор взаимодействует с системой
    посредством специальных устройств (Data Glove), напоминающих перчатки, которые надеваются на руки.
    \item[--] HIVE \cite{hive} - система дополненной реальности. Компания Geomedia занимается созданием медиа-материалов, основанных на погружении
    в среду, таких, как 3D-съёмка высокого разрешения, а также поставляет решения для просмотра таких материалов. Применяется, в частности, во
    многих интерактивных музеях.
    \item[--] IVRE \cite{ivre} - виртуальное окружение для программирования промышленных роботов и роботных систем. С помощью Oculus Rift или
    другой системы отображения можно взаимодействовать с роботом в виртуальном пространстве.
    \item[--] TAN VR-Cube \cite{VRCube} - шести-проекционная система отображения виртуальных сцен с улучшенной проработкой стыков проекций в
    углах. Также обеспечивает полное погружение в сцену.
\end{itemize}

Следует отметить разработку компании VE Group по созданию центра виртуальной реальности в Санкт-Петербургском Университете ГПС МЧС России.
В основе предложенного VE Group решения лежит стационарная проекционная система, состоящая из трех экранов обратной проекции (три стены) и
экрана прямой проекции (пол), образующих куб Full HD-разрешения, обеспечивающих погружение в виртуальную среду. В системе присутствует
оптический трекинг движений. Специальное психофизиологическое оборудование позволяет в реальном времени отслеживать, записывать и анализировать
психофизиологическое состояние человека в зависимости от степени воздействия на него различных виртуальных сцен.

Теоретическими исследованиями проблем восприятия 3D-информации занимается также Институт проблем передачи информации РАН во главе с доктором
биологических наук  Г. И. Рожковой. Она прочитала в 2014 году публичную лекцию об исследованиях института на тему <<Механизмы бинокулярного зрения
человека и восприятие фильмов 3D формата>>.

В целом, практически все приведённые выше исследования на тему восприятия виртуального окружения и оценки погружения в 3D-сцену обладают одним
существенным недостатком - отсутствием способа численного измерения восприятия или погружения. Обосновывается это тем, что в разных условиях и
при решении разных задач слишком сложно (а зачастую и невозможно) выбрать универсальную метрику, по которой можно было бы объективно сравнивать
очень субъективную величину - человеческое восприятие. В данной работе приводится способ численной оценки погружения применительно лишь к одному
типу тренажёров, общая же задача остаётся открытой.

\subsection{Цели и задачи}

Цели работы:

\begin{itemize}
    \item[1)] Разработка метрик оценивания погружения в процесс тренировки на горнолыжном тренажёре МФТИ и восприятия 3D-сцен, отвечающих
    следующим требованиям:
    \begin{itemize}
        \item[--] Метрики должны коррелировать с исследуемым значением (чтобы по изменениям значений метрик можно было судить о погружённости
        в процесс тренировки),

        \item[--] Метрики должны позволять сравнивать параметры тренированности различных спортсменов,

        \item[--] Вычисление метрик должно быть относительная простым (для возможности практического применения).
    \end{itemize}

    \item[2)] Создание приложения с удобным интерфейсом для тренера, позволяющее легко анализировать и сравнивать записанные прохождения трассы
    (в дальнейшем -- заезды) на тренажёре,

    \item[3)] Разработка модуля бинокулярного интерфейса для совмещения реальных и виртуальных объектов.
\end{itemize}


Для достижения первой цели необходимо решить следующие задачи (которые разбиваются на ряд подзадач):
\begin{itemize}
    \item[1)] Провести исследование процесса тренировки на горнолыжном тренажёре:

    \begin{itemize}
        \item[--] Откалибровать систему трекинга и трассу тренажёра,
        \item[--] Настроить экспорт данных,
        \item[--] Написать код для первичной обработки данных,
        \item[--] Разработать метрики, оценивающие погружение в процесс тренировки.
    \end{itemize}

    \item[2)] Провести серию тренировок спортсменов различной степени подготовки, записать данные заездов и применить к ним разработанные метрики.
\end{itemize}

Для достижения второй цели необходимо решить следующие задачи:
\begin{itemize}
    \item[1)] Выделить шаблоны использования и требования к программе от потенциальных пользователей, и с учётом этого разработать архитектуру
    приложения,
    \item[2)] Реализовать приложение на выбранном языке программирования,
\end{itemize}

Для достижения третьей цели необходимо решить следующую задачу:

\begin{itemize}
    \item[1)] Реализовать модуль совмещения реальных и виртуальных объектов бинокулярного интерфейса на примере задачи <<шарик на палке>> $-$
    имеется виртуальный шар, который должен совмещаться с реальным объектом (находиться на конце лыжной палки) при любом взаимном расположении
    наблюдателя и палки.
\end{itemize}

\subsection{Личный вклад автора}

Автором впервые разработаны численные метрики оценивания погружения в процесс тренировки на горнолыжном тренажёре МФТИ, реализовано приложение
TrackAnalyzer для анализа заездов на данном тренажёре, выполняющее вычисления указанных метрик, написан код модуля совмещения реальных и
виртуальных объектов для бинокулярного интерфейса (C++), а также реализовано приложение RedSphere, демонстрирующее работу модуля.

\subsection{Научно-практическая новизна и значимость полученных результатов}

Практическая новизна состоит в определении метрик численной оценки погружённости в процесс тренировки и восприятия 3D-сцены, реализации данных
метрик в пользовательском приложении, в написании кода модуля совмещения реальных и виртуальных объектов для бинокулярного интерфейса, а также
в решении задачи системной интеграции большого числа подсистем (камеры OptiTrack, механическая часть тренажёра, eye-трекер, программа
визуализации, программа обработки данных).

\newpage

\section{Погружённость в процесс тренировки}
\subsection{Определение погружённости, способ оценки}

Как было сказано выше, \textit{погружение в виртуальное окружение} характеризуется как <<всеобъемлющее, воздействующее на различные органы
восприятия окружение, создающее яркую иллюзию присутствия>>. Можно заметить, что данное определение содержит в себе параметры, которые сложно
назвать объективными, и, следовательно, измерить численно. Тем не менее, эффект погружения наблюдается практически во всех тренажёрах с
системами виртуального окружения (исключением не является и горнолыжный тренажёр МФТИ), и воспроизводится у всех наблюдателей. Ярким примером
может служить смена обстановки на трассе горнолыжного тренажёра - после финиша движение продолжает происходить среди заснеженного леса,
и спортсмены, за время заезда погрузившиеся в практически неизменное окружение трассы, интенсивно и удивлённо реагируют на въезд в лесную зону;
отмечалось среди прочего, что они приседают, чтобы увернуться от виртуальных <<веток>>.

Следует различать непосредственно физическое восприятие изображения (сигналы в нервной системе) от когнитивного восприятия (образы в мозгу) и
дальнейшего погружения в виртуальное окружение. Однако, даже зная различие между этими понятиями, ни первое, ни второе нельзя измерить
непосредственно. Из-за больших амплитуд перемещений представляется технически невозможным осуществить прямые измерения показателей организма
(ЭЭГ, ЭКГ, показатели активности участков мозга) у спортсменов, тренирующихся на горнолыжном тренажёре. Соответственно, измерить непосредственное
восприятие через изменения сигналов, поступающих в органы чувств и от них в мозг, также не представляется возможным. Оценивать когнитивное
восприятие 3D-сцены по субъективному описанию ощущений спортсменов представляется не очень перспективным в связи с малой точностью и большой
погрешностью результатов при воспроизведении эксперимента. Другого же способа напрямую получить данные о когнитивных образах, возникающих в
процессе наблюдения 3D-сцен, принципиально не существует.

В свете изложенных выше препятствий к непосредственному измерению погружённости выглядит перспективным следующий подход к получению численных
характеристик, связанных с погружённостью. Устройство визуализатора для горнолыжного тренажёра МФТИ позволяет проводить серию заездов,
практически не <<выключая>> тренирующегося из виртуального окружения. В предположении о том, что при выполнении заезда на одной и той же трассе
и в одном и том же окружении, у спортсмена меняется только погружённость в процесс (а, следовательно, и параметры его заездов), можно определить
некоторый набор метрик, который будет вычисляться по параметрам заездов, и будет хорошо коррелировать с исследуемым уровнем погружённости и
восприятия 3D-сцены.

Таким образом, для изучения изменения выраженности эффекта погружения в данной работе применяется следующий метод. Для сравнимости результатов
все участники эксперимента проходят одну и ту же трассу в одних и тех же условиях, результаты заездов записываются. Далее вычисляется ряд
показателей, коррелирующих с ожидаемыми изменениями в погружённости в процесс тренировки (рост показателей первые несколько заездов в связи с
увеличением вовлечённости и погружения в процесс, затем спад, связанный с усталостью). Имея вычисленные показатели, можно сравнивать также и
тренированность спортсменов по времени наступления спада показателей, средним значениям показателей, их среднеквадратическому отклонению,
а также по совместным распределениям различных показателей.

\subsection{Разработка метрик}
\label{ssec:metrics}

Во время заезда визуализатор тренажёра получает от системы трекинга координаты головы и ног спортсмена в системе координат, связанной с
тренажёром. Далее они, с учётом текущей виртуальной скорости спуска, трансформируются в координаты на трассе, и уже эти координаты сохраняются
вместе с отметкой времени в файл. Кроме трёх координат и времени, сохраняется также расстояние до ближайшей ещё не пройденной на трассе вешки.
Это нужно для того, чтобы далее иметь возможность рассчитывать характеристики плотности прохождения трассы. В случае невзятия ворот, в момент
ошибочного прохождения в это поле записывается значение $-1$.

Записанный заезд по трассе, таким образом, сохраняется в виде массива $M$ записей вида
\[
    (x, y, z, t, dist),
\]
где $x, y, z$ - координаты в виртуальной системе координат, связанной с трассой, $t$ - время, прошедшее со старта, $dist$ - расстояние до
ближайшей непройденной вешки. Обозначим также размер массива $M$ как $N$.

Имея данную информацию, можно вычислить ряд характеристик:
\begin{itemize}
    \item[--] скорость прохождения трассы
\[
    V(t_{n+1}) = \frac{\sqrt{(x_{n+1} - x_{n})^{2} + (y_{n+1} - y_{n})^{2} + (z_{n+1} - z_{n})^{2}}}{t_{n+1} - t_{n}}, n > 0,
\]
    \item[--] среднюю скорость на трассе
\[
    \overline{V} = \frac{\sum\limits_{k=1}^{N} V(t_{k})}{N - 1},
\]
    \item[--] количество пройденных и пропущенных ворот, а также производную от этого величину - вероятность пропуска ворот, рассчитанная по
    данным нескольких заездов. Она должна отражать изменение погружения в пределах одного заезда.
\end{itemize}

Замечено, однако, что скорость, вычисленная по приведённой выше формуле, получается очень шумной, с резкими скачками, поэтому для получения более
стабильных значений скорость сглаживается по следующей формуле:
\[
    V_{smooth_{t}} = \frac{\sum\limits_{k=min(0, t-S/2)}^{max(N, t+S/2)} V(t)}{S}.
\]

То есть, значение сглаженной скорости - это среднее значение скорости в некотором выбранном окне ширины $S$. Для экспериментов было выбрано окно
шириной $S = 500$.

По данным $M$ также можно построить такую важную характеристику заезда, как \textit{плотность прохождения трассы}.
Зададим её как
\[
    P(t): \mathbb{R} \rightarrow \mathbb{R}
\]
\[
    P(t) = \min_{M'}(dist),
\]
где $M'$ - подмножество записей $M$, относящихся к одним воротам трассы, а $t$ - момент прохождения ворот. Так как интерес представляют только
моменты прохождения ворот, то в остальных точках $t'$, в которые ворота не проходились, функцию $P(t')$ можно доопределить кусочно-линейно.
Извлечь такие записи при обработке можно, зная, где закончилось предыдущее множество (или начать с первой записи в случае первых ворот), и
последовательно добавляя в множество $M'$ записи до тех пор, пока абсолютное значение разности соседних значений $dist$ не станет превышать
половины расстояния между воротами. Технические ограничения тренажёра и трассы гарантируют, что расстояние до вешки в момент прохождения ворот
в любом случае будут меньше, чем половина расстояния до следующих ворот. В будущем, разумно будет в формат сохраняемого массива данных $M'$
добавить поле $gate$, которое будет сохранять текущий номер ворот и позволит не закладываться на параметры трассы и тренажёра.

Пример рассчитанной плотности заезда, а также сглаженной скорости этого же заезда, можно увидеть на рис. \ref{fig:compare_all_example}.

\begin{figure}[!ht]
    \centering
    \includegraphics[width=16cm]{pictures/examples/compare_all}
    \caption{Пример плотности и скорости прохождения трассы}
    \label{fig:compare_all_example}
\end{figure}

Функция плотности прохождения характеризует то, насколько близко спортсмен проходил ворота. Чем меньше величина плотности прохождения заданных
ворот, тем меньше времени было потрачено на их прохождение, и, соответственно, тем лучше результат заезда. Замечено, что спортсмен, проходящий
на тренировках одну и ту же трассу несколько раз, стремясь к лучшему результату, проходит её плотнее. Виртуальное окружение призвано создать
вокруг спортсмена иллюзию настоящего склона и <<погрузить>> в себя тренирующегося. Поэтому, если эффект погружения наблюдается, его можно будет
оценить по изменению плотности прохождения одной и той же трассы.

Заметим, однако, что плотность прохождения трассы - это функция, а не число. Получить числовую характеристику заезда из функций плотности можно
разными способами. В данной работе рассматриваются следующие подходы:
\begin{itemize}
    \item[--] средняя величина плотности
\[
    \overline{P(t)} = \frac{\sum\limits_{k=1}^{G} P(t_{k})}{G},
\]
где $G$ - количество ворот, $t_{k}$ - момент взятия $k$-х ворот,
    \item[--] дисперсия плотности
\[
    D(P) = \overline{P^{2}(t)} - \overline{P(t)}^{2},
\]
    \item[--] средняя величина положительной плотности
\[
    \overline{P(t)_{+}} = \frac{\sum\limits_{k=1}^{G} max(0, P(t_{k}))}{G},
\]
    \item[--] дисперсия положительной плотности
\[
    D(P)_{+} = \overline{P_{+}^{2}(t)} - \overline{P_{+}(t)}^{2},
\]
    \item[--] интегральная метрика плотности
\[
    I(P) = \int\limits_{1}^{G} Penalty(P) dt,
\]
где функция $Penalty(P)$ определяется в точках $t_{k}$ взятия ворот, как
\[
    Penalty(P(t_{k})) = 
    \left\{
        \begin{array}{ll}
            P(t_{k}), & \mbox{if } P(t_{k}) > 0 \\
            C_{pen}, & \mbox{otherwise}
        \end{array}
    \right.
    ,
\]
и кусочно-линейно между этими точками.
\end{itemize}

Про интегральную метрику плотности следует дать несколько пояснений. Во-первых, она объединяет в себе две характеристики успешности заезда, а
именно, плотность прохождения трассы и время прохождения, т.е. она будет тем ниже, чем плотнее и быстрее спортсмен прошёл трассу. Во-вторых,
на горнолыжных соревнованиях за невзятие ворот спотрсмен снимается с трассы, здесь же он получает некоторый штраф $C_{pen}$, который увеличивает
итоговую интегральную метрику плотности. Сделано это для того, чтобы не останавливать эксперимент по измерению погружения в процесс тренировки и
не <<вынимать>> спортсмена из виртуального окружения, но, тем не менее, каким-либо заметным образом учесть непрохождение ворот. В данной работе
используется значение $C_{pen} = 10$.

Помимо метрик, вычисляемых по одному параметру заезда, также были разработаны три метрики, принимающие в расчёт два параметра:
\begin{itemize}
    \item[--] IntegralDensityCoefficient -- взаимосвязь интегральной метрики плотности и средней плотности. Они находятся в обратнопропорциональной
    зависимости друг от друга (при постоянном значении коэффициента чем больше средняя плотность - тем ниже должен быть интеграл). Соответственно,
    чем ниже этот коэффициент -- тем лучше. Рассчитывается он по следующей формуле (константа $100$ нужна для нормализации типичных значений
    интегральной метрики плотности):
\[
    IDC(I(P), \overline{P(t)}) = \sqrt{\frac{I(P)}{100}} * \overline{P(t)}.
\]
    Квадратный корень, под которым стоит $I(P)$, нужен для того, чтобы привести к одной размерности интегральную и линейную величины.
    \item[--] VelocityDensityCoefficient -- взаимосвязь средней скорости и средней плотности заезда. Они находятся в прямопропорциональной
    зависимости (чем плотнее и быстрее пройдена трасса -- тем лучше), соответственно, этот коэффициент спортсмены стремятся увеличивать. Формула
    расчёта коэффициента следующая (константа $10$ нужна для нормализации типичных значений средней скорости):
\[
    VDC(\overline{V(t)}, \overline{P(t)}) = \frac{\sqrt{\frac{\overline{V(t)}}{10}}}{\overline{P(t)}}.
\]
    Дробь здесь появляется из-за того, что улучшение плотности происходит за счёт уменьшения $P(t)$, а улучшение скорости - за счёт увеличения
    $V(t)$. Замечено также, что разница в катании между сильными спортсменами и новичками более заметна в плотности катания, а не в скорости,
    поэтому над скоростью стоит нормализующий её квадратный корень.
    \item[--] VelocityIntegralCoefficient -- взаимосвязь средней скорости и интегральной метрики плотности. Они находятся в обратнопрорциональной
    зависимости (при постоянном коэффициенте, чем больше интеграл - тем быстрее должна быть пройдена трасса), но из-за того, что интегральную
    метрику спортсмены стремятся уменьшать, а скорость -- увеличивать, коэффициент тоже нужно увеличивать. Формула расчёта приведена ниже:
\[
    VIC(\overline{V(t)}, I(P)) = \frac{\overline{V(t)}}{\sqrt{I(P)}}.
\]
    Квадратный корень над $I(P)$ нужен по тем же причинам, что и в первом пункте. Коэффициентов нормализации нет, так как они сокращаются друг
    на друга (коэффициент $10$ в верхней части дроби и $\sqrt{100} = 10$ в нижней части).
\end{itemize}

Таким образом, описанные выше метрики, зависящие от одного и двух параметров заезда, рассматриваются как способы оценки изменения погружения в
процесс тренировки.

Отдельно стоит пояснить, почему простейшие способы численной оценки заезда, такие, как время заезда и длина пройденного пути, не подходят в
качестве оценки изменения погружения. Обе эти характеристики не зависят от качества прохождения трассы и количества взятых ворот, а также
имеют минимум значения на заездах <<по прямой>> с максимальной скоростью, следовательно, совсем не коррелирует с исследуемыми значениями.

\newpage

\section{Эксперименты на горнолыжном тренажёре МФТИ}
\subsection{Устройство системы и калибровка}

Система горнолыжного тренажёра состоит из нескольких компонентов, различным образом взаимосвязанных между собой. В неё входят:
\begin{itemize}
    \item[1)] Механический горнолыжный тренажёр SkyTec,
    \item[2)] Система виртуального окружения VEonPC (Virtual Environment on Personal Computer):
    \begin{itemize}
        \item[--] Персональный компьютер с графической картой NVidia Quadro K2000,
        \item[--] Стереопроекционная система Hitachi CP-WX625,
        \item[--] Экран SilverScreen 3x4 метра, расположенный перед механическим тренажёром.
    \end{itemize}
    \item[3)] Система трекинга OptiTrack:
    \begin{itemize}
        \item[--] Три камеры FLEX V100R2 (FOV: 46.2 $^{\circ}$, $f=4.5mm$, 800n$\mu$ (IR) / 700n$\mu$ (Visible)), расположенные в верхней части экрана,
        \item[--] USB OptiHub - устройство, собирающее изображения с камер,
        \item[--] Программное обеспечение Motive OptiTrack, получающее данные с USB-устройства,
        \item[--] Оборудование для калибровки камер - Magic Wand и калибровочный уровень.
    \end{itemize}
    \item[4)] Программа визуализации трассы, получающая данные из системы трекинга по протоколу VRPN \cite{VRPN},
    \item[5)] Устройство для трекинга каретки и шлем с отражающими маркерами для трекинга головы,
    \item[6)] Звуковая стереосистема с двумя колонками,
    \item[7)] Набор поляризованных очков для просмотра стереоизображений.
\end{itemize}

Отдельные компоненты системы трекинга представлены на рис. \ref{fig:components}.

\begin{figure}[!ht]
    \centering
    \begin{subfigure}{.5\textwidth}
        \centering
        \includegraphics[width=.8\linewidth]{pictures/components_a}
        \captionsetup{width=.8\linewidth}
        \caption{Magic Wand, калибровочный уровень и устройство трекинга каретки}
    \end{subfigure}%
    \begin{subfigure}{.5\textwidth}
        \centering
        \includegraphics[width=.8\linewidth]{pictures/components_b}
        \captionsetup{width=.8\linewidth}
        \caption{Камера FLEX V100R2, установленная слева от поляризованного экрана}
    \end{subfigure}
\caption{Отдельные компоненты системы трекинга OptiTrack}
\label{fig:components}
\end{figure}

Взаимосвязь компонентов системы представлена на рис. \ref{fig:system_connection}.

\begin{figure}[!ht]
    \centering
    \includegraphics[width=16cm]{pictures/system_connection}
    \caption{Система горнолыжного тренажёра МФТИ}
    \label{fig:system_connection}
\end{figure}

Калибровка системы проводится в несколько этапов.

Предварительный этап, который выполняется один раз - это установка проекторов и камер. Камеры должны охватывать всю область, где происходит
перемещение спортсмена на тренажёре.

Затем проводится калибровка системы оптического трекинга. Поскольку линзы камер являются выпуклыми, все прямые в них искажаются и принимают
дугообразную форму. Для того, чтобы осуществлять преобразование из линейных евклидовых координат в искривлённую систему координат, связанную с
камерами, необходимо восстановить отображение прямых из одной системы координат в другую. Для этого всю область трекинга <<заметают>>
устройством Magic Wand, параметры которого (расстояние между соседними маркерами) известны программе. Маркеры на устройстве расположены на одной
прямой, и затем по данным <<заметания>> строится интерполяционная матрица, по которой вычисляются коэффициенты перевода координат.

Далее выставляется начало системы координат трекинга. Обычно это уровень с тремя маркерами, обозначающими две оси координат ($X$ и $Z$),
расположенный горизонтально. Третья ось вычисляется как перпендикулярная первым двум.

После этого калибруется старт виртуальной трассы. Программа визуализации реализована так, что все перемещения вдоль оси $X$ (вдоль которой
перемещается каретка) вычисляются относительно стартовой позиции, которая расположена чуть левее центра трассы. Для этого необходимо найти и
отметить эту точку на тренажёре за несколько пробных заездов.

\subsection{План измерений, экспорт данных}

В данной работе исследовались четыре группы тренирующихся. В первую входили три спортсмена из горнолыжной секции МФТИ, которые регулярно
тренируются на горнолыжном тренажёре. Вторую группу составлял автор работы. В третью группу входили люди, не занимавшиеся ранее горными лыжами
и не катавшиеся на тренажёре. Четвёртую (контрольную) группу составляли неизвестные автору люди, измерения проводились без присутствия автора.
Было решено добавить контрольную группу в эксперимент для того, чтобы независимо оценить качество разработанных методик, а также сделать
предположение о том, насколько хорошо тренированы люди из этой группы.

Измерения проводились по следующей схеме. Группа спортсменов и группа с автором были поставлены в условия проезда одной и той же трассы несколько
раз с увеличивающейся скоростью. Группа <<любителей>> каталась на минимальной скорости, про контрольную группу условия не известны. Данные
каждого заезда записывались в описанном выше формате в виде массива $M$ в отдельный файл и далее обрабатывались одинаково с помощью разработанной
программы анализа заездов. Количество ворот во всех заездах выровнено до 58, первые двое ворот выключены из анализа в связи с тем, что они
расположены слишком близко к старту, что не соответствует обычному расположению ворот на настоящих слаломных трассах. Также в анализ не
включались пробные заезды и <<выбросы>> -- заезды, где трасса пройдена не до конца или во время заезда происходили ошибки оборудования.


\newpage

\section{Разработка приложения для анализа данных с тренировок}
\subsection{Требования к приложению, выбор платформы}

Приложение для анализа заездов, разрабатываемое в рамках данной работы, должно отвечать следующим требованиям:
\begin{itemize}
    \item[--] Позволять проводить анализ одного и/или нескольких заездов,
    \item[--] Во время анализа вычислять метрики, описанные в разделе \ref{ssec:metrics},
    \item[--] Иметь режим работы для сравнения пар метрик, также описанных в разделе \ref{ssec:metrics},
    \item[--] Строить графики изменения значений метрик и подписывать графики, поддерживать возможность сохранения построенных графиков как
    изображение формата PNG,
    \item[--] Запускаться под Windows и быть по возможности кроссплатформенным,
    \item[--] Иметь удобный интерфейс, не перегруженный лишними деталями.
\end{itemize}

Для разработки была выбрана платформа Qt, как отвечающая требованиям кроссплатформенности и удобной разработки графических приложений. С
использованием этой же платформы ранее было разработано приложение для запуска программы визуального окружения тренажёра. Для построения графиков
был использован Gnuplot, подключение к приложению производилось с помощью низкоуровневой библиотеки gnuplot-iostream, которая распространяется
бесплатно на Github \cite{gnuplot-iostream}.

\subsection{Режимы работы приложения}

Во время работы приложения в него могут быть загружены несколько наборов заездов (sets). Каждый набор может состоять из одного или нескольких
заездов. В интерфейсе имеются кнопки ``Open file(s)..'' и ``Open directory(-ies)..'', позволяющие создать набор, состоящий из одного или
нескольких файлов или директорий с заездами, соответственно. Имя набора вычисляется как название объемлющей директории или название директории и
название файла, если он единственный в наборе. Также в интерфейсе имеются кнопки добавления файлов и директорий в наборы (в интерфейсе они
расположены рядом с соответствующими им парами кнопок открытия и подписаны знаками ``+''), которые позволяют добавить наборы к уже имеющимся в
памяти (две предыдущие кнопки очищают память загруженных наборов и создают один новый).

Приложение имеет три основных режима работы -- ``Compare all'', ``Compare sets'' и ``2D graphs''. Два из этих режимов (``Compare sets'' и
``2D graphs'') позволяют работать только с положительными значениями плотности заезда, игнорируя отрицательные. Для этого в интерфейсе предусмотрена
опция ``Density+'' (по умолчанию выключена). Также третий режим работы позволяет в процессе построения графиков зависимостей метрик друг от друга
включать отображение центра точек каждого набора. Для этого в интерфейсе имеется опция ``Cluster centers'' (по умолчанию также выключена). Каждый
режим работы помимо построения графиков выводит текстовую информацию со значениями вычисляемых метрик в предназначенное для это текстовое поле.

Общий вид интерфейса приложения приведён на рис. \ref{fig:track_analyzer_interface}.

\begin{figure}[!ht]
    \centering
    \includegraphics[width=8cm]{pictures/track_analyzer_interface}
    \caption{Интерфейс приложения TrackAnalyzer}
    \label{fig:track_analyzer_interface}
\end{figure}

В режиме работы ``Compare all'' все заезды из каждого набора анализируются отдельно, при этом строятся следующие графики:
\begin{itemize}
    \item[--] Плотность $P(t)$ каждого заезда,
    \item[--] Скорость $V(t)$ каждого заезда.
\end{itemize}

Пример построенных графиков приведён на рис. \ref{fig:compare_all_example}.

Также относительно каждого заезда вычисляются значения следующих метрик (представлены в виде текста):
\begin{itemize}
    \item[--] Интегральная метрика $I(P)$,
    \item[--] Количество пропущенных ворот,
    \item[--] Средняя плотность $\overline{P(t)}$,
    \item[--] Средняя положительная плотность $\overline{P_{+}(t)}$,
    \item[--] Дисперсия плотности $D(P)$,
    \item[--] Дисперсия положительной плотности $\overline{D{P}}$,
    \item[--] Средняя скорость $\overline{V(t)}$.
\end{itemize}

В связи с тем, что графики плотности имеют некоторый разброс и при наложении друг на друга создают достаточно смешанную картину, использование
этого режима с более, чем пятью заездами одновременно приводит к не совсем понятному графику плотности. Текстовые данные о каждом заезде
расположены друг за другом и разделены специальными символами.

В режиме работы ``Compare sets'' анализируются наборы заездов, при этом строится четыре графика:
\begin{itemize}
    \item[--] Изменение интегральной метрики плотности в зависимости от номера заезда в наборе,
    \item[--] Вероятность пропуска ворот, рассчитанная для данного набора,
    \item[--] Изменение средней плотности (или средней положительной плотности при включённом режиме ``Density+'') в зависимости от номера заезда,
    \item[--] Изменение средней скорости в зависимости от номера заезда.
\end{itemize}

Пример построенных графиков приведён на рис. \ref{fig:compare_sets_example}.

\begin{figure}[!ht]
    \centering
    \includegraphics[width=17cm]{pictures/examples/compare_sets}
    \caption{Графики, полученные с помощью TrackAnalyzer в режиме ``Compare sets''}
    \label{fig:compare_sets_example}
\end{figure}

Помимо графиков, в данном режиме вычисляются и выводятся в виде текстовой таблицы средние, максимальные и минимальные значения интегральной
метрики плотности, количества пропущенных ворот, плотности (или положительной плотности) и средней скорости для каждого набора заездов.

В режиме работы ``2D graphs'' приложение строит три графика:
\begin{itemize}
    \item[--] Изменение значений пары $\left( I(P), \overline{P/P_{+}(t)} \right)$,
    \item[--] Изменение значений пары $\left( \overline{V(t)}, \overline{P/P_{+}(t)} \right)$,
    \item[--] Изменение значений пары $\left( \overline{V(t)}, I(P) \right)$.
\end{itemize}

Пример построенных графиков (с отмеченными центрами наборов) приведён на рис. \ref{fig:2d_graphs_example}.

\begin{figure}[!ht]
    \centering
    \includegraphics[width=17cm]{pictures/examples/2d_graphs}
    \caption{Графики, полученные с помощью TrackAnalyzer в режиме ``2D graphs''}
    \label{fig:2d_graphs_example}
\end{figure}

Кроме графиков, в текстовом виде выводятся средние и лучшие значения коэффициентов IDC, VDC и VIC, описанных в разделе \ref{ssec:metrics},
а также координаты центров кластеров точек из каждого набора (при включённой соответствующей опции).

Графики, полученные в каждом режиме работы приложения, можно сохранить как изображение PNG, нажав на соответствующую кнопку ``Save to PNG'' и
введя название файла для сохранения изображения.

\newpage

\section{Анализ экспериментальных данных}
\subsection{Проверка качества разработанных метрик}

В ходе экспериментов было получено 52 записанных заезда по трассе. Первое, что следует сделать, имея настоящие данные -- это проверить
адекватность разработанных метрик. Для этого исследуем диапазоны значений, которые они принимают, сравним показатели спортсменов и любителей и
убедимся в том, что наблюдаемые изменения совпадают с ожидаемыми.

Максимальные, минимальные и средние значения четырёх из семи рассматриваемых метрик собраны в таблицах \ref{table:int-gate-miss}-\ref{table:mean-dens-velo}.
Изучив эти данные, можно убедиться, что диапазон изменения каждой метрики не выходит за рамки разумного и ожидаемого.

Хорошо заметно, что интегральная метрика плотности $I(P)$ эффективно отличает спортсменов от любителей -- её значения различаются на этих группах
в 6-10 раз. Количество пропущенных ворот также хорошо отличает новичков от спортсменов (с разницей в значениях примерно в четыре раза). В случае
метрики средней плотности заезда эффект различия выражен меньше, хотя всё равно присутствует.

\newpage

\begin{table}[!ht]
\centering
\caption{Минимальные, средние и максимальные значения интегральной метрики плотности $I(P)$ и усреднённое количество пропущенных ворот}
\label{table:int-gate-miss}
\begin{tabular}{|l|l|l|l|l|}
\hline
$I(P)$                     & \# & min   & max   & mean  \\ \hline
\multirow{3}{*}{sportsmen} & 1  & 66.4  & 213.0 & 121.3 \\ \cline{2-5} 
                           & 2  & 42.7  & 263.3 & 152.7 \\ \cline{2-5} 
                           & 3  & 43.5  & 314.4 & 116.0 \\ \hline
\multirow{4}{*}{sandler}   & 1  & 51.5  & 51.5  & 51.5  \\ \cline{2-5} 
                           & 2  & 41.9  & 87.3  & 63.2  \\ \cline{2-5} 
                           & 3  & 45.7  & 108.8 & 68.1  \\ \cline{2-5} 
                           & 4  & 50.3  & 65.7  & 58.0  \\ \hline
\multirow{3}{*}{amateurs}  & 1  & 473.9 & 723.3 & 568.3 \\ \cline{2-5} 
                           & 2  & 946.8 & 946.8 & 946.8 \\ \cline{2-5} 
                           & 3  & 912.0 & 913.5 & 912.8 \\ \hline
\multirow{4}{*}{control}   & 1  & 250.9 & 280.0 & 265.5 \\ \cline{2-5} 
                           & 2  & 119.8 & 334.7 & 201.8 \\ \cline{2-5} 
                           & 3  & 246.4 & 416.5 & 320.8 \\ \cline{2-5} 
                           & 4  & 313.3 & 313.3 & 313.3 \\ \hline
\end{tabular}
\quad
\begin{tabular}{|l|l|l|l|l|}
\hline
gate-miss                  & \# & min & max & mean \\ \hline
\multirow{3}{*}{sportsmen} & 1  & 1   & 8   & 4    \\ \cline{2-5} 
                           & 2  & 0   & 14  & 7    \\ \cline{2-5} 
                           & 3  & 0   & 16  & 4    \\ \hline
\multirow{4}{*}{sandler}   & 1  & 0   & 0   & 0    \\ \cline{2-5} 
                           & 2  & 0   & 3   & 1    \\ \cline{2-5} 
                           & 3  & 0   & 6   & 1    \\ \cline{2-5} 
                           & 4  & 0   & 1   & 1    \\ \hline
\multirow{3}{*}{amateurs}  & 1  & 15  & 29  & 22   \\ \cline{2-5} 
                           & 2  & 48  & 48  & 48   \\ \cline{2-5} 
                           & 3  & 30  & 39  & 35   \\ \hline
\multirow{4}{*}{control}   & 1  & 6   & 7   & 7    \\ \cline{2-5} 
                           & 2  & 1   & 11  & 5    \\ \cline{2-5} 
                           & 3  & 6   & 13  & 9    \\ \cline{2-5} 
                           & 4  & 8   & 8   & 8    \\ \hline
\end{tabular}
\end{table}

\begin{table}[!ht]
\centering
\caption{Минимальные, средние и максимальные значения средней плотности $\overline{P(t)}$ и средней скорости $\overline{V(t)}$}
\label{table:mean-dens-velo}
\begin{tabular}{|l|l|l|l|l|}
\hline
$\overline{P(t)}$          & \# & min   & max   & mean  \\ \hline
\multirow{3}{*}{sportsmen} & 1  & 0.543 & 0.614 & 0.582 \\ \cline{2-5} 
                           & 2  & 0.550 & 0.595 & 0.578 \\ \cline{2-5} 
                           & 3  & 0.472 & 0.692 & 0.577 \\ \hline
\multirow{4}{*}{sandler}   & 1  & 0.657 & 0.657 & 0.657 \\ \cline{2-5} 
                           & 2  & 0.567 & 0.786 & 0.704 \\ \cline{2-5} 
                           & 3  & 0.493 & 0.908 & 0.783 \\ \cline{2-5} 
                           & 4  & 0.828 & 0.852 & 0.840 \\ \hline
\multirow{3}{*}{amateurs}  & 1  & 0.521 & 0.634 & 0.584 \\ \cline{2-5} 
                           & 2  & 0.892 & 0.892 & 0.892 \\ \cline{2-5} 
                           & 3  & 0.806 & 0.843 & 0.825 \\ \hline
\multirow{4}{*}{control}   & 1  & 0.660 & 0.752 & 0.706 \\ \cline{2-5} 
                           & 2  & 0.591 & 0.642 & 0.615 \\ \cline{2-5} 
                           & 3  & 0.518 & 0.698 & 0.627 \\ \cline{2-5} 
                           & 4  & 0.685 & 0.685 & 0.685 \\ \hline
\end{tabular}
\quad
\begin{tabular}{|l|l|l|l|l|}
\hline
$\overline{V(t)}$          & \# & min   & max   & mean  \\ \hline
\multirow{3}{*}{sportsmen} & 1  & 12.79 & 13.43 & 13.16 \\ \cline{2-5} 
                           & 2  & 12.89 & 12.93 & 12.92 \\ \cline{2-5} 
                           & 3  & 11.53 & 15.44 & 14.23 \\ \hline
\multirow{4}{*}{sandler}   & 1  & 13.41 & 13.41 & 13.41 \\ \cline{2-5} 
                           & 2  & 12.11 & 16.35 & 13.93 \\ \cline{2-5} 
                           & 3  & 13.71 & 17.74 & 15.37 \\ \cline{2-5} 
                           & 4  & 16.30 & 16.31 & 16.31 \\ \hline
\multirow{3}{*}{amateurs}  & 1  & 9.31  & 9.36  & 9.33  \\ \cline{2-5} 
                           & 2  & 8.82  & 8.82  & 8.82  \\ \cline{2-5} 
                           & 3  & 9.35  & 9.39  & 9.37  \\ \hline
\multirow{4}{*}{control}   & 1  & 9.31  & 9.33  & 9.32  \\ \cline{2-5} 
                           & 2  & 9.30  & 9.38  & 9.35  \\ \cline{2-5} 
                           & 3  & 9.28  & 9.38  & 9.33  \\ \cline{2-5} 
                           & 4  & 9.26  & 9.26  & 9.26  \\ \hline
\end{tabular}
\end{table}

\newpage

Рассмотрим также три оставшиеся метрики -- это введённые в разделе \ref{ssec:metrics} коэффициенты IDC, VDC и VIC. Их лучшие и средние значения
приведены в таблице \ref{table:coefs}

\begin{table}[!ht]
\centering
\caption{Лучшие и средние значения коэффициентов IDC, VDC и VIC}
\label{table:coefs}
\begin{tabular}{|l|l|l|l|}
\hline
IDC                        & \# & best & mean \\ \hline
\multirow{3}{*}{sportsmen} & 1  & 0.46 & 0.62 \\ \cline{2-4} 
                           & 2  & 0.35 & 0.68 \\ \cline{2-4} 
                           & 3  & 0.31 & 0.58 \\ \hline
\multirow{4}{*}{sandler}   & 1  & 0.47 & 0.47 \\ \cline{2-4} 
                           & 2  & 0.42 & 0.55 \\ \cline{2-4} 
                           & 3  & 0.50 & 0.62 \\ \cline{2-4} 
                           & 4  & 0.60 & 0.63 \\ \hline
\multirow{3}{*}{amateurs}  & 1  & 1.13 & 1.39 \\ \cline{2-4} 
                           & 2  & 2.74 & 2.74 \\ \cline{2-4} 
                           & 3  & 2.43 & 2.49 \\ \hline
\multirow{4}{*}{control}   & 1  & 1.04 & 1.15 \\ \cline{2-4} 
                           & 2  & 0.67 & 0.85 \\ \cline{2-4} 
                           & 3  & 1.04 & 1.11 \\ \cline{2-4} 
                           & 4  & 1.21 & 1.21 \\ \hline
\end{tabular}
\quad
\begin{tabular}{|l|l|l|l|}
\hline
VDC                        & \# & best & mean \\ \hline
\multirow{3}{*}{sportsmen} & 1  & 2.13 & 1.97 \\ \cline{2-4} 
                           & 2  & 2.06 & 1.96 \\ \cline{2-4} 
                           & 3  & 2.62 & 2.10 \\ \hline
\multirow{4}{*}{sandler}   & 1  & 1.76 & 1.76 \\ \cline{2-4} 
                           & 2  & 2.25 & 1.70 \\ \cline{2-4} 
                           & 3  & 2.69 & 1.68 \\ \cline{2-4} 
                           & 4  & 1.54 & 1.51 \\ \hline
\multirow{3}{*}{amateurs}  & 1  & 1.85 & 1.66 \\ \cline{2-4} 
                           & 2  & 1.05 & 1.05 \\ \cline{2-4} 
                           & 3  & 1.19 & 1.17 \\ \hline
\multirow{4}{*}{control}   & 1  & 1.46 & 1.37 \\ \cline{2-4} 
                           & 2  & 1.63 & 1.57 \\ \cline{2-4} 
                           & 3  & 1.86 & 1.55 \\ \cline{2-4} 
                           & 4  & 1.40 & 1.40 \\ \hline
\end{tabular}
\quad
\begin{tabular}{|l|l|l|l|}
\hline
VIC                        & \# & best & mean \\ \hline
\multirow{3}{*}{sportsmen} & 1  & 1.62 & 1.29 \\ \cline{2-4} 
                           & 2  & 1.97 & 1.27 \\ \cline{2-4} 
                           & 3  & 2.27 & 1.60 \\ \hline
\multirow{4}{*}{sandler}   & 1  & 1.86 & 1.86 \\ \cline{2-4} 
                           & 2  & 2.34 & 1.79 \\ \cline{2-4} 
                           & 3  & 2.40 & 1.91 \\ \cline{2-4} 
                           & 4  & 2.29 & 2.15 \\ \hline
\multirow{3}{*}{amateurs}  & 1  & 0.42 & 0.39 \\ \cline{2-4} 
                           & 2  & 0.28 & 0.28 \\ \cline{2-4} 
                           & 3  & 0.31 & 0.31 \\ \hline
\multirow{4}{*}{control}   & 1  & 0.58 & 0.57 \\ \cline{2-4} 
                           & 2  & 0.85 & 0.69 \\ \cline{2-4} 
                           & 3  & 0.59 & 0.52 \\ \cline{2-4} 
                           & 4  & 0.52 & 0.52 \\ \hline
\end{tabular}
\end{table}

Можно заметить, что по значениями всех трёх коэффициентов можно хорошо различить группу начинающих и группу спортсменов. Изменение значений также
находится в пределах разумного, выбросы отсутствуют.

Анализируя все семь коэффициентов, можно сделать предварительное заключение о том, что люди, составляющие контрольную группу, по уровню
подготовки находятся посередине между любителями и спортсменами, и, вероятно, при проведении замеров в этой группе оператор тренажёра не
использовал увеличение скорости (или не знал о такой опции). О заездах в группе, состоящей из автора данной работы, можно сказать то, что они
были выполнены достаточно чисто, но очень ``широко'', то есть, средняя плотность заезда была гораздо больше, чем у спортсменов.

\subsection{Сравнительный анализ различных групп тренирующихся}

Проведём теперь более наглядное сравнение групп тренирующихся с помощью построенных в разработанном приложении графиков.

\begin{figure}[!ht]
    \centering
    \begin{subfigure}{.5\textwidth}
        \centering
        \includegraphics[width=.9\linewidth]{pictures/graphs/sportsmen_int_density}
        \captionsetup{width=.8\linewidth}
        \caption{Сравнение заездов первой исследуемой группы в режиме ``Compare sets'' }
    \end{subfigure}%
    \begin{subfigure}{.5\textwidth}
        \centering
        \includegraphics[width=.9\linewidth]{pictures/graphs/sandler_int_density}
        \captionsetup{width=.8\linewidth}
        \caption{Сравнение заездов второй исследуемой группы в режиме ``Compare sets'' }
    \end{subfigure}
\caption{Сравнение интегральной метрики плотности и средней плотности заездов}
\label{fig:graphs_int_dens}
\end{figure}

Построенные и приведённые на рис. \ref{fig:graphs_int_dens} графики позволяют сделать несколько важных наблюдений.

Во-первых, наблюдается тенденция уменьшения интегральной метрики плотности вплоть до третьего-четвертого заездов в тренировке, далее наблюдается
стабильный рост. Это и ожидалось увидеть в качестве подтверждения гипотезы об увеличении погружения в процесс тренировки, и наступающей затем
усталости и ухудшению показателей.

Во-вторых, наблюдается уменьшение средней плотности заезда в течение всей тренировки. Это также подтверждает гипотезу о том, что, стремясь пройти
трассу лучше, спортсмен приспосабливается к виртуальному окружению и погружается в него.

Сравним теперь распределения пар метрик $\left(I(P), \overline{P(t)}\right)$, $\left(\overline{V(t)}, \overline{P(t)}\right)$ и \\
$\left(I(P), \overline{V(t)}\right)$, которые приведены на рис. \ref{fig:graphs_2d_graphs}. Эти распределения рассчитаны для всех четырёх групп
спортсменов.

\begin{figure}[!ht]
    \centering
    \includegraphics[width=16cm]{pictures/graphs/2d_graphs}
    \caption{Распределение пар метрик $\left(I(P), \overline{P(t)}\right)$, $\left(\overline{V(t)}, \overline{P(t)}\right)$ и $\left(I(P), \overline{V(t)}\right)$}
    \label{fig:graphs_2d_graphs}
\end{figure}

Расчёт графиков был произведён объединением всех заездов каждой группы в одно множество, без учёта конкретного спортсмена, выполняющего заезд.

На приведённом выше графике можно наблюдать одну интересующую нас особенность. Хорошо видно, что кластеры точек, представляющие каждую группу,
почти не пересекаются. Это означает, что метрики выбраны удачно, и даёт нам возможность определить, насколько хорошо тренирован спортсмен, по
близости к одному из уже известных кластеров. Именно так и были разработаны коэффициенты IDC, VDC и VIC. Первый представляет из себя множитель
гиперболы, проходящей через центр кластера (следует из обратнопропорциональой зависимости метрик), второй и третий определяются как величины,
пропорциональные тангенсу угла наклона прямой, выходящей из нуля и проходящей через центр кластера (следует из прямопропорциональной зависимости
метрик).

Наконец, рассмотрим последнюю интересующую нас метрику -- вероятность пропуска ворот в зависимости от их номера. Значения этой величины,
рассчитанные для каждой группы в отдельности и для всех заездов в общем, приведены на рис. \ref{fig:graphs_gate_miss_prob}

\begin{figure}[!ht]
    \centering
    \begin{subfigure}{.5\textwidth}
        \centering
        \includegraphics[width=.95\linewidth]{pictures/graphs/gate_miss_prob}
        \captionsetup{width=.8\linewidth}
        \caption{Вероятность пропуска ворот, рассчитанная для каждой группы в режиме ``Compare sets'' }
    \end{subfigure}%
    \begin{subfigure}{.5\textwidth}
        \centering
        \includegraphics[width=.95\linewidth]{pictures/graphs/data_gate_miss_prob}
        \captionsetup{width=.8\linewidth}
        \caption{Вероятность пропуска ворот, рассчитанная для всех заездов в общем в режиме ``Compare sets'' }
    \end{subfigure}
\caption{Вероятность пропуска ворот в зависимости от их номера}
\label{fig:graphs_gate_miss_prob}
\end{figure}

Можно наблюдать, что для каждой группы в отдельности и для всех заездов в общем вероятность пропуска ворот уменьшается с увеличением их номера.
Этот факт говорит нам о том, что в течение каждого заезда происходит увеличение погружения в виртуальное окружение по сравнению с началом заезда,
что тоже ожидалось увидеть при измерениях.

\subsection{Выводы}

Подводя итог экспериментальной части работы, можно сказать, что все выдвинутые в начале работы гипотезы подтверждены -- погружённость
действительно увеличивается в течение тренировки до тех пор, пока не наступает усталость. Разработанный набор метрик подобран удачно, он позволяет
не только оценить изменение погружения в виртуальное окружение горнолыжного тренажёра, но и оценить тренированность спортсмена.

Все результаты были получены при помощи разработанного автором приложения TrackAnalyzer.

\newpage

\section{Модуль совмещения объектов в бинокулярном интерфейсе}

Данный раздел посвящён проблеме совмещения реальных и виртуальных объектов 3D-сцен тренажёров. Дадим более подробное описание этой проблемы.

Классический подход к изображению 3D-сцен состоит в том, чтобы вычислять координаты полигонов изображения по трём матрицам -- матрице модели
$M_{model}$, матрице вида $M_{view}$ и матрице проекции $M_{proj}$. Вычисление экранных координат точки $v$ производятся следующим образом:
\[
    v' = M_{proj} \cdot M_{view} \cdot M_{model} \cdot v.
\]

Проблема при таком подходе заключается в том, что матрица проекции обычно не перевычисляется, а задаётся однажды, исходя из геометрии пирамиды
видимости. Однако, в случае, когда наблюдатель перемещается, пирамида видимости изменяется (см. рис. \ref{fig:binocular_pyramid}). Пример
расхождения изображений при таком подходе можно наблюдать на рис. \ref{fig:binocular_bad}.

\begin{figure}[!ht]
    \centering
    \includegraphics[width=16cm]{pictures/binocular/pyramid}
    \caption{Изменение пирамиды видимости при перемещении наблюдателя относительно экрана}
    \label{fig:binocular_pyramid}
\end{figure}

\begin{figure}[!ht]
    \centering
    \begin{subfigure}{.33\textwidth}
        \centering
        \includegraphics[width=.9\linewidth]{pictures/binocular/bad_l}
        \captionsetup{width=.8\linewidth}
        \caption{Наблюдатель находится слева от центра}
    \end{subfigure}%
    \begin{subfigure}{.33\textwidth}
        \centering
        \includegraphics[width=.9\linewidth]{pictures/binocular/bad_c}
        \captionsetup{width=.8\linewidth}
        \caption{Наблюдатель находится в центре}
    \end{subfigure}
    \begin{subfigure}{.33\textwidth}
        \centering
        \includegraphics[width=.9\linewidth]{pictures/binocular/bad_r}
        \captionsetup{width=.8\linewidth}
        \caption{Наблюдатель находится справа от центра}
    \end{subfigure}
\caption{Расхождение реального объекта и его виртуального <<двойника>>}
\label{fig:binocular_bad}
\end{figure}

В случае задачи совмещения (для наблюдателя) реального и виртуального объекта в одной точке необходимо при каждом перемещении наблюдателя
соответствующим образом перестроить матрицу проекции, исходя из его актуальной пирамиды видимости. Матрицы вида и модели при этом менять не нужно,
так как сама 3D-сцена остаётся неподвижной. Однако, если реальный объект, с которым производится совмещение, также перемещается, то необходимо
менять также и матрицу вида.

\newpage

Для задания пирамиды видимости необходимо знать шесть чисел -- две $x$- и $y$-координаты основания пирамиды, а также $z$-координаты основания и
вершины пирамиды. Эти координаты вычисляются из известных от системы трекинга координат головы наблюдателя (предварительно выполняется ещё одно
преобразование координат трекинга для того, чтобы получить координаты левого и правого глаза).

Модуль совмещения реальных и виртуальных объектов реализован на C++ с использованием библиотек OpenSceneGraph, в качестве примера использования
выступает приложение RedSphere, разработанное автором данной работы. Изображения на рис. \ref{fig:binocular_bad} получены в ходе работы приложения
при выключенной перегенерации матрицы проекции. Код модуля, отвечающий за генерацию актуальной матрицы проекции, приведён на рис. \ref{fig:binocular_code}.

\begin{figure}[!ht]
    \centering
    \includegraphics[width=16cm]{pictures/binocular/code}
    \caption{Код вычисления актуальной матрицы проекции}
    \label{fig:binocular_code}
\end{figure}

Пример работы приложения при включенном режиме перегенерации матрицы проекции приведён на рис. \ref{fig:binocular_good}. На нём видно, что при
перемещении наблюдателя влево и вправо реальный и виртуальный объекты остаются совмещёнными. В настоящий момент приложение усовершенствовано
таким образом, что координаты реального объекта также передаются в программу из системы трекинга, и пропадает необходимость задавать координаты
объекта при компиляции программы, а затем выставлять реальный объект точно в эти координаты в системе координат трекинга.

\begin{figure}[!ht]
    \centering
    \begin{subfigure}{.33\textwidth}
        \centering
        \includegraphics[width=.9\linewidth]{pictures/binocular/good_l}
        \captionsetup{width=.8\linewidth}
        \caption{Наблюдатель находится слева от центра}
    \end{subfigure}%
    \begin{subfigure}{.33\textwidth}
        \centering
        \includegraphics[width=.9\linewidth]{pictures/binocular/good_c}
        \captionsetup{width=.8\linewidth}
        \caption{Наблюдатель находится чуть правее центра}
    \end{subfigure}
    \begin{subfigure}{.33\textwidth}
        \centering
        \includegraphics[width=.9\linewidth]{pictures/binocular/good_r}
        \captionsetup{width=.8\linewidth}
        \caption{Наблюдатель находится справа от центра}
    \end{subfigure}
\caption{Совмещение реального объекта и его виртуального <<двойника>>}
\label{fig:binocular_good}
\end{figure}

Наличие такого модуля в тренажёрах специального вида (например, полётный тренажёр МиГ-29), требующих совмещения реальных и виртуальных объектов,
позволяет существенно увеличить погружение и улучшить восприятие 3D-сцен, и тем самым положительно влиять на ход тренировок.

\newpage

\section{Заключение}

Все цели, поставленные в данной работе, были достигнуты:

\begin{itemize}
    \item[1)] Разработаны метрики оценивания погружения в процесс тренировки на горнолыжном тренажёре МФТИ и восприятия 3D-сцен
    \begin{itemize}
        \item[--] Изменения значений метрик доказывают наличие и увеличение погружённости в процесс тренировки,

        \item[--] Метрики позволяют сравнивать тренированность различных спортсменов,
    \end{itemize}

    \item[2)] Разработано приложение TrackAnalyzer, позволяющее легко анализировать и сравнивать заезды на тренажёре,

    \item[3)] Разработан модуль бинокулярного интерфейса для совмещения реальных и виртуальных объектов, реализовано демонстрационное приложение
    RedSphere, демонстрирующее работу модуля.
\end{itemize}

Разработанные приложения установлены на компьютер горнолыжного тренажёра МФТИ, отвечающий за расчёт виртуального окружения тренажёра. Исходные
коды приложения распространяются бесплатно и могут быть модифицированы для дальнейших исследований кем угодно.

\newpage

\section{Благодарности}
Автор выражает благодарность Владимиру Петровичу Алёшину за научное руководство при написании данной работы, а также Станиславу Владимировичу Клименко,
Марии Александровне Берберовой и всем сотрудникам Кафедры Физико-Технической Информатики МФТИ за неоценимую поддержку и помощь в работе.

\newpage

\bibliographystyle{gost/gost780u}
\bibliography{diploma}

\end{document}
